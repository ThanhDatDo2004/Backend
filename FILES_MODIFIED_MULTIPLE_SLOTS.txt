â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  MULTIPLE TIME SLOTS - FILES MODIFIED
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ DANH SÃCH CÃC FILE ÄÃƒ THAY Äá»”I

File: backend/src/controllers/booking.controller.ts

1ï¸âƒ£ Sá»­a phÆ°Æ¡ng thá»©c: listBookings() (Line 13-112)
   âœ… ThÃªm query: Fetch táº¥t cáº£ Field_Slots cho tá»«ng booking
   âœ… Format StartTime, EndTime thÃ nh HH:mm
   âœ… Tráº£ vá» máº£ng slots Ä‘áº§y Ä‘á»§ trong response
   
   TRÆ¯á»šC:
   âŒ slots: slots || []
   
   SAU:
   âœ… SELECT DATE_FORMAT(StartTime, '%H:%i') as StartTime
   âœ… ORDER BY PlayDate, StartTime
   âœ… Táº¥t cáº£ slots Ä‘á»u Ä‘Æ°á»£c tráº£ vá»

2ï¸âƒ£ Sá»­a phÆ°Æ¡ng thá»©c: getBooking() (Line 266-342)
   âœ… ThÃªm query: Fetch táº¥t cáº£ Field_Slots cho booking
   âœ… Format times, sort by date
   âœ… Tráº£ vá» slots array trong response
   
   TÆ°Æ¡ng tá»± nhÆ° listBookings()

3ï¸âƒ£ Sá»­a phÆ°Æ¡ng thá»©c: listShopBookings() (Line 680-800)
   âœ… ThÃªm fetch slots logic
   âœ… Format times
   âœ… Tráº£ vá» slots array
   
   TÆ°Æ¡ng tá»± cho shop bookings

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  CODE CHANGES SUMMARY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

QUERY THÃŠM:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SELECT 
  SlotID,
  PlayDate, 
  DATE_FORMAT(StartTime, '%H:%i') as StartTime,
  DATE_FORMAT(EndTime, '%H:%i') as EndTime,
  Status 
FROM Field_Slots 
WHERE BookingCode = ?
ORDER BY PlayDate, StartTime

LOGIC THÃŠM:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const bookingsWithSlots = await Promise.all(
  enrichedBookings.map(async (booking: any) => {
    const [slots] = await queryService.query<RowDataPacket[]>(query);
    return {
      ...booking,
      slots: slots || []
    };
  })
);

RESPONSE Má»šI:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
{
  BookingCode: 123,
  FieldName: "SÃ¢n A",
  StartTime: "10:00",
  EndTime: "11:00",
  slots: [
    { SlotID: 1, StartTime: "10:00", EndTime: "11:00" },
    { SlotID: 2, StartTime: "11:00", EndTime: "12:00" }
  ]
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ENDPOINTS AFFECTED
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. GET /api/bookings
   âœ… Tráº£ vá» slots array cho má»—i booking

2. GET /api/bookings/:bookingCode
   âœ… Tráº£ vá» slots array cho booking

3. GET /api/shops/me/bookings
   âœ… Tráº£ vá» slots array cho má»—i booking

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  BENEFITS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Hiá»ƒn thá»‹ táº¥t cáº£ khung giá» Ä‘Ã£ chá»n
âœ… KhÃ´ng thay Ä‘á»•i database schema
âœ… KhÃ´ng thay Ä‘á»•i booking creation logic
âœ… Format times dá»… Ä‘á»c (HH:mm)
âœ… Sáº¯p xáº¿p slots theo ngÃ y/giá»
âœ… TÆ°Æ¡ng thÃ­ch vá»›i frontend má»›i/cÅ©
âœ… Dá»… má»Ÿ rá»™ng (thÃªm pagination cho slots náº¿u cáº§n)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  BEFORE vs AFTER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

BEFORE:
â”€â”€â”€â”€â”€â”€â”€
{
  BookingCode: 123,
  StartTime: "10:00",
  EndTime: "11:00",
  slots: []  âŒ TRá»NG HOáº¶C CHá»ˆ 1 SLOT
}

AFTER:
â”€â”€â”€â”€â”€â”€
{
  BookingCode: 123,
  StartTime: "10:00",
  EndTime: "11:00",
  slots: [
    { SlotID: 1, PlayDate: "2025-10-22", 
      StartTime: "10:00", EndTime: "11:00" },
    { SlotID: 2, PlayDate: "2025-10-22", 
      StartTime: "11:00", EndTime: "12:00" }
  ]  âœ… Táº¤T Cáº¢ CÃC SLOTS
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  DATABASE (NO CHANGES)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Bookings table: VáºªN GIá»® NGUYÃŠN
- BookingCode (PK)
- FieldCode
- PlayDate
- StartTime (slot Ä‘áº§u)
- EndTime (slot Ä‘áº§u)
- TotalPrice (tÃ­nh cho táº¥t cáº£ slots)

Field_Slots table: VáºªN GIá»® NGUYÃŠN
- SlotID (PK)
- FieldCode
- BookingCode (FK) â† QUAN TRá»ŒNG
- PlayDate
- StartTime (slot thá»© N)
- EndTime (slot thá»© N)
- Status

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  PERFORMANCE NOTES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š Performance Impact: MINIMAL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

- ThÃªm 1 query per booking Ä‘á»ƒ fetch slots
- Vá»›i pagination (limit 10), = 10 extra queries per request
- CÃ¡c query nhá» (< 1ms má»—i cÃ¡i)
- CÃ³ index trÃªn BookingCode (FK)

âš¡ Optimization cÃ³ thá»ƒ lÃ m sau:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Cache results (Redis)
2. Batch queries vá»›i IN clause
3. Aggregate slots khi fetching bookings
4. Paginate slots náº¿u cÃ³ 100+ slots per booking

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  TESTING STEPS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Build backend:
   cd backend && npm run build

2. Start server:
   npm start

3. Test GET /api/bookings:
   curl http://localhost:5050/api/bookings

4. Verify response has slots array with multiple items

5. Test GET /api/bookings/123:
   curl http://localhost:5050/api/bookings/123

6. Verify all slots appear in response

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  FRONTEND INTEGRATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Frontend nháº­n Ä‘Æ°á»£c:

```json
{
  "slots": [
    {"StartTime": "10:00", "EndTime": "11:00"},
    {"StartTime": "11:00", "EndTime": "12:00"},
    {"StartTime": "12:00", "EndTime": "13:00"}
  ]
}
```

CÃ³ thá»ƒ render:
- List cÃ¡c time slots
- Timeline visualization
- Báº£ng vá»›i cá»™t "Khung giá»"
- Tá»•ng thá»i gian: 3 giá»

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  DEPLOYMENT CHECKLIST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â˜‘ Sá»­a booking.controller.ts
â˜‘ Compile TypeScript
â˜‘ No linting errors
â˜‘ Test 3 endpoints
â˜‘ Verify slots in response
â˜‘ Deploy to staging
â˜‘ Smoke test
â˜‘ Deploy to production

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
